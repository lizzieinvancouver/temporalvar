\documentclass[11pt,letter]{article}
\usepackage[top=1.00in, bottom=1.0in, left=1.1in, right=1.1in]{geometry}
\renewcommand{\baselinestretch}{1.1}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage{amsmath}
\usepackage{hyperref}


\def\labelitemi{--}
\parindent=0pt

\begin{document}
\bibliographystyle{/Users/Lizzie/Documents/EndnoteRelated/Bibtex/styles/besjournals}
\renewcommand{\refname}{\CHead{}}

% Next steps!
% Lizzie writes up notes a little
% Then Lizzie plays around with cleaning up the code
% Megan works on ResCompN.R 

{\bf Notes on germination model for Dan}\\
\emph{By Lizzie \& Megan so far}\\

Megan and I discussed the changes needed to do simulations for Dan's germination questions. Specifically, Dan is interested in building from the data from his germination trials and competition experiment to do some forecasting of how climate change could shift competitive outcomes due to priority effects.

\section{What needs to change?}

We need a model that has priority effects (where species can switch their order across years), and to add `chilling' somehow to the model. Specifically we want a model where with maximum chilling you get your maximum germination at the earliest time. This means that lower chilling will have two effects: lower germination, and later germination. \\

{\bf How it compares to previous model:} 
(1) In our previous model both species start at the same time ($\delta T = 0$). Now we will explicitly include the time-lag (but we may be able to make that within year part an equivalence) and now changes in timing become a f(x) of chilling and how that connects to resource pulse (so how the cues connect to the resource pulse timing).\\

In our original model, we had a start of season parameter ($\tau_p$) that determined the germination amount for each species (depending on how close $\tau_i$ was to $\tau_p$) and changed each year. Here, (2) we will keep $\tau_p$ constant and effectively allow the start of season to always be the same---what Lizzie is thinking of as a biological start of season---and species will germinate after that date depending on their species-level parameters + chilling that year. \\

Another way to put this ... last time we assumed $\tau_i$ was fixed and moved around $\tau_p$ (and what mattered was the distance); now we assume $\tau_p$ is fixed and species move around depending on chilling. {\bf Do we need this?} we asked ourselves. Yes, because we need germination to not be instanteous with $\tau_p$. Also, Lizzie adds---it's nice as it's more equivalent to there being a biological start of the season and that there are `early' and `late' species relative to that.

One more important outcome of these changes---in our previous model tracking put you closer to pulse and you germinated more, here you can have a priority effect and get a big benefit without using so many seeds (before, with tracking, you germinated at a high fraction every year). 

\section{Some obvious outcomes...}
... that we discussed.

\begin{enumerate}
\item If (1) species vary by their start times, (2) all start times occur after the pulse (meaning there is no negative outcome of ever being too early), and (3) species cannot switch their order across years ... then the earliest species will generally win as it's first to the party (the resource party). If you're thinking---wait, maybe we should model a cost to being too early! Then Lizzie (and Megan of years past) replies: that's the main thing you'll model then and it may be more useful in an evolutionary model perhaps. In our current model trade-offs such as between timing and competitiveness represent the ghost of these costs. 
\item One potential way out of this problem above (earliest wins) is to have the chilling positively correlated with resource, such that lower chilling years are low resource years (smaller pulse). In this case species that delay also germinate less (so they use up less of their seedbank) and if the resource is low maybe this will be a good decision (bet-hedging wins the day?)! However, this means that high resource years are high interspecific competition years (in those years all species germinate early and at max germination) so you get postive $covar(E,C)$, which is what you need for the storage effect---as then it dampens the benedit any one species could get from a good environmental year.... but it still seems unlikely that germinating less and later in low chill years will be a good strategy.
\item One way out of this is to covary chilling delay species with competitiveness (if you delay, you are also a superior competitor under low resource conditions). This is what Megan and I looked at in our paper. It makes sense, but it may not be the only way to get coexistence, and it may not be what we want to focus on here. 
\end{enumerate}


\section{How to vary germination timing, new!} 

How to vary germination time (relative to pulse) with more chilling? \\

This is harder than you think, and makes you realize why abstracting within-season time the way the storage effect model does may be a great idea. We went through several iterations of how to do this. Here's our current thought process:\\

\begin{enumerate}
\item No trade-off with chilling delay and $R^*$ for now. 
\item There is variation across species in their `natural start time,' which is currently called $\tau_{i}$ (though for a bit of June we called it $\tau_{g,i}$ or)
\item Chilling (or chilling/heating combo) does two major things ... 
\begin{enumerate}
\item Chilling (or chilling/heating combo) impacts the delay, and that delay can {\bf switch the order of species} such that some some years species 1 is ahead of species 2 and some years that is reversed.
\item Chilling (or chilling/heating combo) also impacts the germination fraction
\item We set up parameters such that these two effects (delay and germination fraction) to be independent (that is, they don't covary to the point that you cannit separate the impact of each, which is an alternative idea we discussed). 
\end{enumerate}
\item The season starts with the first species. So we set the pulse of $R$ to occur at the timing of the first species. Just like empirical ecologists we define the start of the season biotically (not abiotically). 
\end{enumerate}

Also ... smaller things (SKIP reading for meetings)
\begin{enumerate}
\item All species do not go at same time with max chilling. (If we wanted them to all go at once with max, the chilling f(x) would have to be fairly complicated to get species to switch order.) 
\end{enumerate}

\section{Start here.} 

{\bf Next meeting:} Look at where the edit the code, look at some non-linear plots from Dan.\\

\emph{13 October meeting} (\href{https://jamboard.google.com/d/1jvab46saD2Dey8uOg-C_ruWeGzxKyXvdBScyxB5FUCk/viewer?f=0}{jamboard}): 

We will have $g$ vary with chilling ($C$ here). $g$ has three parameters, $g_0$ (the amount of germination without chilling), $g_{max}$ and $\gamma$. Do we want all to vary? We discussed:

\begin{itemize}
\item Maybe $g_{max}$=1 (is always 100\%). Why not! That's how we calculated it in the data, and we could think of this as a model for viable seeds, and all seeds would germinate with enough chilling. But we miss species that seem similar but only differ towards the very extremes of chilling at their $g_{max}$ (Dan said this happens a lot in his data, I think?).
\item $g_0$ the amount of germination without chilling; this varies by species, since some species germinate without chilling
\item $\gamma_g$ rate at which germination increases from min to max with chilling
\end{itemize}

$g=g_0 + (g_{max}-g_0)(1-e^{-\gamma_g*C})$ \\

So maybe best to explore the data and model before deciding? Using some least squares or such non-linear cheap R package (and do some good initial conditions). Lizzie notes: I would just put chilling in as weeks. \\

Other part we need is the delay due to chilling. 
\begin{itemize}
\item $\tau_{nc}$ -- delay with no chilling
\item $\tau_{min}$ -- minimium delay with maximum chilling.
\end{itemize}
We think the shape could be a linear model (instead of exponential), with some species constant (slope of delay vs. chilling=0), $y$-intercept represents maximum delay with no chilling. If we do linear, we have to build in a stop for cases where you end up with negative delay values (e.g., low intercept, high slope).\\

Then we talked about whether we should switch to a dose-response curve (DRC). Handy in many ways, but does not allow us to separately vary timing from germination in the same way; it does not really estimate delay. We'd have to create one for each level of chilling. \emph{We decided that what we have is simpler and thus better.} \\

\emph{27 September 2021:} We decided to vary only chilling at this meeting. And we decided on instaneous chilling (not trying to have a curve through time).\\

\emph{Update from 22 September 2021:} We realized we need to decide how to model germination: is it a germination curve each season (can we do this in the ODE solver? Might be more realistic and similar to data, but not how we want the model to be) or is it an amount you go one day (in which case we can use that info in the initial conditions of the ODE solver)?\\

\emph{Update from 7 September 2021:} Megan is busy working away in R to look at f(x)al forms of equations (see \verb|R/checks/checkFunctionForms_priorityeffs.R|), ended on discussing integrals of germination curves (an important possible constraint we might impose: have all species go the same amount? Or not, since it varies in the experiment a lot; or at least need to calculate this). One point she stressed (31 Aug 2021): remember that our $g$ equation this time will {\bf not} mean the same thing as it did in our storage effect model; this time it is representing the germination curves within a season (e.g., as we seem them in an experiment). {\bf For the next meeting: keep working on equations and editing R code}\\

 {\bf Plan to get Dan up to speed! Meet with him, tell him what we've done (focusing just on this model), and set up some next steps. } \\

Update from 17 August 2021: Megan worked on equations based on all the new figures... (see 2021JAug17MDnotes1.jpeg).\\

Update from 13 August 2021: We're going with chilling and forcing! It doesn't really add parameters. Because we only have two levels of forcing it's a multiplicative constant, it doesn't really matter how we parameterize it ... but we could just parameterize it as we know it works in other systems (i.e., woody tree leafout) and then it's more generalizable. \\

There's basically three things we can adjust ... Megan is working on an equation that allows all three to be adjusted and then we can use Dan's data to decide what we should adjust.\\

End of of 13 August 2021 update.\\

Now, we need:
\begin{enumerate}
\item Decide: are we switching to chilling and heating units? Can we get them both in without more parameters? (See above, yes and yes as of 13 August 2021.)
\item To help with this decision Lizzie should make some plots ... 
\begin{enumerate}
\item Total \% germinated by chilling (by species)  -- two panels: one for ambient and one for warm
\item Germination day by chilling units -- two panels (or two symbols): one for ambient and one for warm (one graph for each species)
\end{enumerate}
\item a firm f(x) to define how chilling (or chilling/heating combo) impacts delay and ...
\item how chilling impacts germination fraction and ...
\item how we model chilling as an environmental parameter (do we model chill units? Or amount of chill below max? Or ...?). 
\end{enumerate}

Related to this, we also have not answered (have we?):
\begin{enumerate}
\item What aspects of chilling (or chilling/heating combo) response are unique to species? What could vary ... (Megan's notes from 17 Jul 2021)
\begin{enumerate}
\item Required chillling for timing
\item Sensitivity of timing to chilling (unit delay per unit reduced chilling)
\item Sensitivity of germination fraction to chilling
\item Correlation of sensitivity to chilling for germination and timing
\item Assume: All species have same max germination
\end{enumerate}
\item What aspects of the environment will vary in simulations?
\item What aspects of species will vary in the simulations?
\end{enumerate}


\section{How to vary germination timing, old...} 

This is from June 2021 meetings; can likely delete once we finalize new parameters etc. in July 2021 (hopefully will finish in July, we'll see!).\\

Season starts at resource pulse (that's within-season $t=0$). And we introduce some new parameters...
\begin{itemize}
\item $\tau_{g,i}$ -- {\bf species-specific germination timing} given maximum chilling (must be after pulse)
\item $\tau_{g,i}$ can be delayed due to chilling with $\tau_{c,i}$ -- {\bf species-specific delay} given less than maximum chilling
\item So, $\tau_{g,i} + \tau_{c,i}$ would be {\bf the realized germination date}, which we refer to as $\hat{\tau_{g,i}}$. 
\end{itemize}

This model allows the following trade-offs:
\begin{itemize}
\item $R^*$ versus $\tau_{g,i}$ 
\item $R^*$ versus $\tau_{c,i}$ 
\end{itemize}
Constraint: Species that do not delay with chilling should have a higher germination fraction.\\

We'll have a new germination equation, that depends on {\bf chilling} ($\xi$):
$g_i = g_{max, i}e^{(-\xi)^2/h}$\\
$\tau_c = f(\xi)$ [could just be linear with threshold, or exponential etc.]\\

While we agreed that $g_{max}$ likely varies by species, and will generally be lower for species with later $\tau_{g,i}$, we decided not to vary this as we have enough to vary already.\\

Trade-offs inherent in the model:
\begin{itemize}
\item $R*$ vs. $\tau_{g,i}$
\item $R*$ vs. $\tau_{c,i}$
\end{itemize}

\section{Equations} 
We keep the year to year dynamics ...
\begin{align}
N_{i}(t+1) & =
s_{i}(N_{i}(t)(1-g_{i}(t))+\phi_{i}B(t+\delta)
\end{align}
And the production of new biomass each season still follows a basic $R^*$ competition model: new biomass production depends on its resource uptake ($f_i(R)$ converted into biomass at rate $c_i$) less maintenance costs ($m_i$), with uptake controlled by $a_i$ and $u_i$:
\begin{align}
\frac{\partial B_{i}}{\partial t} &  = [c_{i}f_{i}(R) - m_{i}]B_{i} \\
f_{i}(R) & = \frac{a_{i}R^{\theta_{i}}}{1+a_{i}u_{i}R^{\theta_{i}}}
\end{align}

The resource ($R$) itself declines across a growing season due to uptake by all species and abiotic loss ($\epsilon$):
\begin{align}
\frac{\mathrm{d}R}{\mathrm{d}t} & = - \sum_{i=1}^{n}f_{i}(R)B_{i} -\epsilon R
\end{align}


With the initial condition ({\bf second line is new}):
\begin{align}
B(t+0) & = N_{i}(t)g_{i}(t)b_{0,i}\\
B_i(t=\hat{\tau_{g,i}}) & = N_{i}(t)g_{i}(t)b_{0,i}
\end{align}

And germination is now dependent on chilling ...

\begin{align}
g_i(t) & = g_{max}e^{-\xi^2/h}
\end{align}

Though we have not defined the chilling function yet. 



\section{How to implement} 

Use a two-stage ODE: solve for the first species and resource for a fixed number of days, then use that as the initial conditions for the second stage, where you add the other species.

% Define the following for all species:
% $g_{max}$ (this could vary for species, with later species likely having lower $g_{max}$, but we think best to skip this for now and keep constant across all species) 
% $h$

Stuff we do no longer need:\\
\begin{itemize}
\item tracking
\item $\tau_i$
\end{itemize}

\section{Next steps}

See \verb|_READMEpriorityeff.txt|

\begin{itemize}
\item Adding in two-step ODE (Megan says this is very straightforward)
\item  Build an environment with heating, cooling and resource pulse — and relate back to $\tau_i$
\begin{itemize}
\item Try species with same germination fraction no matter the environment
\item Try species with increasing fraction with more chilling 
\end{itemize}
\item Think on two strategies versus continuous (or is continuous low warming).
\item Stick with our old parameters? 
\end{itemize}

covar(pulse size, chill units) -- discussed in relation to what happens in years when one species is early and draws down the resource below later species' $R*$ (we think that they still go but hopefully they don't germinate too much) or change covar(epsilon, chill units)\\

\end{document}


